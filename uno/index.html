<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <h1>Hola mundo</h1>
  <label for="titulo">Titulo del libro :
    <input type="text" name="titulo" id="titulo" placeholder="ingrese titulo">
  </label>
  <label for="autor"> Autor:
    <input type="text" name="autor" id="autor" placeholder="ingrese autor">
  </label>
  <button id="add-book">Agregar</button>
<script src="https://www.gstatic.com/firebasejs/6.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-database.js"></script>
<script>
  // Your web app's Firebase configuration
  console.log('inicio');
  const firebaseConfig = {
    apiKey: "AIzaSyC9nf5lTAkqqcHYhtq2mAzAsRdn7Rw4ySU",
    authDomain: "my-not-so-awesome-proyect.firebaseapp.com",
    databaseURL: "https://my-not-so-awesome-proyect.firebaseio.com",
    projectId: "my-not-so-awesome-proyect",
    storageBucket: "",
    messagingSenderId: "674941339443",
    appId: "1:674941339443:web:a8ff7b0200887b07e8e046"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  console.log('dos');
</script>
<script>
  console.log('tres');
  const refBooks = firebase.database().ref('books');
  const buttonAddBook = document.getElementById('add-book');  
  const inputTitulo = document.getElementById('titulo');
  const inputAutor = document.getElementById('autor');

  console.log('cuatro');
  const addReference = (rootReef, obj) => {
    const newRef = rootReef.push();
    obj.id = newRef.key.toString();
    newRef.set(obj)
  }

console.log('cinco')
  buttonAddBook.addEventListener('click', () => {
    addReference(refBooks, {
      titulo: inputTitulo.value,
      autor : inputAutor.value
    })
    inputTitulo.value = '';
    inputAutor.value = '';
    console.log('seis');
    console.log(getData(refBooks)); 
  })
</script>
<script>
/* Once está promisificado
 firebase.database().ref('books').once("value")
  .then(function(snapshot) {
    snapshot.forEach(function(childSnapshot) {
      // key will be "ada" the first time and "alan" the second time
      var key = childSnapshot.key;
      // childData will be the actual contents of the child
      var childData = childSnapshot.val();
  });
});
*/
</script>
<script>
// Como callbacks está el on
console.log('siete');
const getData = (ref) => {
  const arr = [];
  ref.on('value', (data) => {
    data.forEach((ele)=>{
      arr.push(ele.val());
    })
    console.log(arr);
  })
  
}

console.log(getData(refBooks));
/* refBooks.on('value', function(snapshot) {
  console.log('ocho');
  console.log(snapshot.val());
  console.log(snapshot.numChildren());
  snapshot.forEach((ele)=>{
    console.log(ele.val().id);
    console.log(ele.key);
  })
}); */
console.log('fin')
</script>
<script>
/* refBooks.on("value")
  .then(function(snapshot) {
    var a = snapshot.hasChildren(); // true
    var b = snapshot.child("name").hasChildren(); // true
    var c = snapshot.child("name/first").hasChildren(); // false
  }); */
</script>
</body>
</html>